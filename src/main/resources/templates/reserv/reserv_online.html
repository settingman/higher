<!DOCTYPE html>
<html>
  <head>
    <title>Calendar Example</title>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  </head>
  <body>
    <!-- <progress id="progress" value="50" min="0" max="100"></progress> -->
    <div class="total">
      <div class="float_inner">
    <form method="post" enctype="multipart/form-data" th:action="@{/reserv/reserv.do}">
        <div class="exhib_info">
          <div class="exhib_tit">
            <div class="makeup-main">
   			  <input type="hidden" name="mid" class="mid" value="angz">
   			  <input type="hidden" name="rimg" class="rimg" id="rimg" value="">
              <img src="https://necteltechnologies.com/site/wp-content/uploads/it-consulting.jpeg">
            </div>
            <ul class="exhib_list" id="floatPC_layer" style="text-align: center">
              <span style="">온라인 프로그램</span>
            </ul>
          </div>
          <ul class="list_info">
            
            <li id="floatPC_daytime">날짜 -
            </li>
            
            <li id="floatPC_time">시간 -
             <div class="hiddentime" style="display: none;"></div>
            </li>
          </ul>
          <div class="applybtn">
            <span type="submit" class="reservi" disabled>예약하기</span>
          </div>
        </div>
        </form>
      </div>
    <div class="mainbody">
      <!-- 달력 -->
      <div class="tit" title="날짜 선택" id="step1-head" tabindex="0">
        <h3 class="g-title-1">날짜 선택</h3>
      </div>
      <div class="calendartable">
        <div class="accordion_cont">
          <div class="calendargrid">
            <div class="calendar">
              <table>
                <tr>
                  <td align="center">
                    <button onclick="prevCalendar()">Prev</button>
                  </td>
                  <td colspan="5" align="center" id="calendarTitle"></td>
                  <td align="center">
                    <button onclick="nextCalendar()">Next</button>
                  </td>
                </tr>
                <tr>
                  <th style="color: red">Sun</th>
                  <th>Mon</th>
                  <th>Tue</th>
                  <th>Wed</th>
                  <th>Thu</th>
                  <th>Fri</th>
                  <th style="color: blue">Sat</th>
                </tr>
                <tbody id="calendarBody"></tbody>
              </table>
            </div>
            <dl class="calendar_info" style="margin-left: 20px">
              <dt>예약 안내</dt>
              <dd>
                <p>
                  온라인 예약은 프로그램 한달 전부터 가능하며, 상담은 6개월이
                  지나야 재예약이 가능합니다.
                </p>
                <p>
                  원활한 상담을 위해 반드시 예약 사항을 지켜주시기 바라며,
                  상담이 어려우시면 다른 고객을 위해 반드시 예약를 취소해 주시기
                  바랍니다.
                </p>
              </dd>
            </dl>
          </div>
        </div>
      </div>
        <!-- /달력 -->
        <div class="tit" title="시간 선택" id="step1-head" tabindex="0">
          <h3 class="g-title-1">시간 선택</h3>
        </div>
        <!-- 시간대-->
        <div class="timetable" style="display: none">
          <div class="accordion_cont1" style="">
            <div class="time_wrap clickTime" id="time_body2">
              <ul class="clickTime_left">
                <li class="select_time">
                  <a href="#" title=""
                    ><span class="time" style="float: left" value="10:00:00">10:00</span
                    ><span style="float: right">예약 가능</span
                    ></a>
                </li>
                <li class="select_time">
                  <a href="#" title=""
                    ><span class="time" style="float: left" value="11:00:00">11:00</span
                    ><span style="float: right">예약 가능</span
                    ></a>
                </li>
                <li class="select_time">
                  <a href="#" title=""
                    ><span class="time" style="float: left" value="12:00:00">12:00</span
                    ><span style="float: right">예약 가능</span
                    ></a>
                </li>
                <li class="select_time">
                  <a href="#" title=""
                    ><span class="time" style="float: left" value="13:00:00">13:00</span
                    ><span style="float: right">예약 가능</span
                    ></a>
                </li>
              </ul>
              <ul class="clickTime_right">
                <li class="select_time">
                  <a href="#" title=""
                    ><span class="time" style="float: left" value="14:00:00">14:00</span
                    ><span style="float: right">예약 가능</span
                    ></a>
                </li>
                <li class="select_time">
                  <a href="#" title=""
                    ><span class="time" style="float: left" value="15:00:00">15:00</span
                    ><span style="float: right">예약 가능</span
                    ></a>
                </li>
                <li class="select_time">
                  <a href="#" title=""
                    ><span class="time" style="float: left"  value="16:00:00">16:00</span
                    ><span style="float: right">예약 가능</span
                    ></a>
                </li>
                <li class="select_time">
                  <a href="#" title=""
                    ><span class="time" style="float: left" value="17:00:00">17:00</span
                    ><span style="float: right">예약 가능</span
                    ></a>
                </li>
              </ul>
              <div style="clear: both"></div>
            </div>
          </div>
        </div>
      
      <!-- /시간대-->
      <!-- 사진 업로드 -->
      <div class="tit" title="사진 업로드" id="step1-head" tabindex="0">
        <h3 class="g-title-1">사진 업로드</h3>
      </div>
      <div class="uploadimage" style="display: none;">
        <div class="accordion_cont">
          <div class="uploadbox">
            <div
              class="uploadResult"
              style="
                width: 300px;
                height: 400px;
                background: darkgray;
                float: left;
              "
            ></div>
       <div class="rightbox" style="float: right">
              <div class="g_box" style="margin: 0; float: right">
                <dl>
                  <dt>GUIDE</dt>
                  <dd>정확한 상담을 위해 다음을 지켜주세요<br></dd>
                  <dd>1. 밝은 곳에서 찍은 사진</dd>
                  <dd>2. 화장하지 않은 상태의 사진</dd>
                  <dd>3. 눈 코 입을 가리지 않은 얼굴형이 드러나는 사진</dd>
                  <dd>사진은 상담 이외의 목적으로 사용되지 않습니다.</dd>
                  <dd>사진은 6개월 보관 후 폐기됩니다.</dd>
                </dl>
              </div>
              <div class="makeupbtn1">
              
                <div class="btn_green">
              <label for="file">
              	<div class="btn-upload" style="height: 40px; line-height: 40px;">파일 찾기</div>
              </label>
              <input type="file" name="file" id="file" style="display:none;">
                </div>
                <div class="btn_green1" style="margin-right: 30px;">
                <label for="uploadFiles">
                  <p class="uploadBtn">등록하기</p>
                  </label>
                  <input name="uploadFiles" type="file" style="display:none;">
                </div>     
              </div>
            </div>
        </div>
      </div>
      <!-- /사진 업로드 -->
    </div>
  </div>
</div>
<script>
      let today = new Date();
      let currentMonth = today.getMonth();
      let currentYear = today.getFullYear();

      function buildCalendar() {
        let firstDay = new Date(currentYear, currentMonth, 1);
        let lastDay = new Date(currentYear, currentMonth + 1, 0);
        let calendarTitle = document.getElementById("calendarTitle");
        let calendarBody = document.getElementById("calendarBody");
        let twoWeeksFromToday = new Date();
        twoWeeksFromToday.setDate(today.getDate() + 14);

        calendarTitle.innerHTML =
          currentYear + "년 " + (currentMonth + 1) + "월";

        while (calendarBody.firstChild) {
          calendarBody.removeChild(calendarBody.firstChild);
        }

        let date = 1;
        for (let i = 0; i < 6; i++) {
          let row = document.createElement("tr");
          for (let j = 0; j < 7; j++) {
            if (i === 0 && j < firstDay.getDay()) {
              let cell = document.createElement("td");
              let cellText = document.createTextNode("");
              cell.appendChild(cellText);
              row.appendChild(cell);
            } else if (date > lastDay.getDate()) {
              break;
            } else {
              let cell = document.createElement("td");
              let cellText = document.createTextNode(date);
              if (
                date === today.getDate() &&
                currentMonth === today.getMonth() &&
                currentYear === today.getFullYear()
              ) {
                cell.classList.add("current-day");
              }
              if (
                date > today.getDate() &&
                date <= twoWeeksFromToday.getDate() &&
                currentMonth === today.getMonth() &&
                currentYear === today.getFullYear()
              ) {
                cell.classList.add("two-weeks");
              	cell.addEventListener("click", showTimetable); // 클릭 이벤트 추가
              }
              cell.appendChild(cellText);
              row.appendChild(cell);
              date++;
            }
          }
          calendarBody.appendChild(row);
        }
      }

      function prevCalendar() {
        currentYear = currentMonth === 0 ? currentYear - 1 : currentYear;
        currentMonth = currentMonth === 0 ? 11 : currentMonth - 1;
        buildCalendar();
      }

      function nextCalendar() {
        currentYear = currentMonth === 11 ? currentYear + 1 : currentYear;
        currentMonth = (currentMonth + 1) % 12;
        let twoWeeksFromToday = new Date();
        twoWeeksFromToday.setDate(twoWeeksFromToday.getDate() + 14);
        buildCalendar();
      }
      let selectedYear, selectedMonth;

      function showTimetable(event) {
        let selectedDate = event.target.textContent;
        let selectedYear = currentYear;
        let selectedMonth = currentMonth + 1;
        let selected = document.getElementById("selected");
        if (selected) {
          selected.remove();
        }
        console.log(
          `Selected Date: ${selectedYear}-${selectedMonth}-${selectedDate}`
        );
        let yearParent = document.querySelector(".accordion_cont1");
        let yearDiv = document.createElement("div");
        let ymd = document.querySelector("#floatPC_daytime");
        let ymdvalue = document.querySelector(".hiddendaytime");
        yearDiv.classList.add("selected");
        yearDiv.id = "selected";
        ymd.innerHTML = "날짜 - " + selectedYear + "-" + selectedMonth + "-" + selectedDate;
        //ymdvalue.value= selectedYear + "-" + selectedMonth + "-" + selectedDate;
        console.log(selectedYear + "-" + selectedMonth + "-" + selectedDate);
        yearDiv.innerHTML ="Selected date: " + selectedYear + "-" + selectedMonth + "-" + selectedDate;
        yearParent.appendChild(yearDiv);
        //document.querySelector(".timetable").appendChild(yearDiv);
        document.querySelector(".timetable").style.display = "block";
        document.querySelector(".calendartable").style.display = "none";
      }

      buildCalendar();
    </script>
    <script>
      let calendarBody = document.getElementById("calendarBody");
      let timetable = document.querySelector(".timetable");

      calendarBody.addEventListener("click", function (event) {
        if (event.target.tagName === "TD") {
          timetable.style.display = "block";
        }
      });

      let timetablebtn = document.querySelector(".timetable");
      let timeSelect = document.querySelector('[title="시간 선택"]');
      timeSelect.addEventListener("click", function () {
        if (timetablebtn.style.display === "none") {
          timetablebtn.style.display = "block";
        } else {
          timetablebtn.style.display = "none";
          uploadpagebtn.style.display = "none";
        }
      });

const selectTimes = document.querySelectorAll('.select_time');

selectTimes.forEach(selectTime => {
  selectTime.addEventListener('click', function() {
	let dateText = document.querySelector("#floatPC_daytime").innerHTML.substring(5);
    let timeText = this.querySelector('.time').textContent;
    document.querySelector('#floatPC_time').innerHTML = "시간 - " + timeText + "<input type='hidden' name='rdate' class='rdate' id='rdate' value='"+ dateText +" "+ timeText + ":00'>";
  });
});

    let uploadpagebtn = document.querySelector(".uploadimage");
      let uploadSelect = document.querySelector('[title="사진 업로드"]');
      uploadSelect.addEventListener("click", function () {
        if (uploadpagebtn.style.display === "none") {
          uploadpagebtn.style.display = "block";
        } else {
          uploadpagebtn.style.display = "none";
        }
      });

      let calendarpagebtn = document.querySelector(".calendartable");
      let calendarSelect = document.querySelector('[title="날짜 선택"]');
      calendarSelect.addEventListener("click", function () {
        if (calendarpagebtn.style.display === "none") {
          calendarpagebtn.style.display = "block";
        } else {
          calendarpagebtn.style.display = "none";
        }
      });

    </script>
  	<script>
		   function showUploadedImages(arr) {
			console.log(arr);
			var divArea = $(".uploadResult");
			var str = "";
			var removebtn = $(".removeBtn");
			for (var i = 0; i < arr.length; i++) {
			    str += "<div style='text-align:-webkit-center;'>";
			    str += "<img src='/reserv/display?fileName=" + arr[i].thumbnailURL + "'>";
			    str += "<input type='hidden'name='reimg' class='reimg' id='reimg' value='" + arr[i].imageURL + "'>";
			    str += "<div class='btn_gray' data-name='" + arr[i].imageURL + "'>";
			    str += "<label for='removeBtn'>";
			    str += "<p>삭제</p>";
			    str += "<button class='removeBtn' name='removeBtn' data-name='" + arr[i].imageURL + "' style='display:none;'></button>";
			    str += "</label>";
			    str += "</div>";
			    str += "</div>";
			    
			    $(".rimg").val(arr[i].imageURL);
			  }
			  divArea.append(str);
			  
			}

		$('.uploadBtn').click(function() {
			var formData = new FormData();
			var inputFile = $("input[type='file']");
			var files = inputFile[0].files;
			for (var i = 0; i < files.length; i++) {
				console.log(files[i]);
				formData.append("uploadFiles", files[i]);
			}

			$.ajax({
				url : '/reserv/upload.do',
				processData : false,
				contentType : false,
				data : formData,
				type : 'POST',
				dataType : 'json',
				success : function(result) {
					console.log(result);
					showUploadedImages(result);
				},
				error : function(jqXHR, textStatus, errorThrown) {
					console.log(textStatus);
				}
			});

		});

		$(".uploadResult").on("click", ".btn_gray", function(e) {
			var target = $(this);
			var fileName = target.data("name");
			var targetDiv = $(this).closest("div");
			console.log(fileName);
			$.post('/reserv/removeFile', {
				fileName : fileName
			}, function(result) {
				console.log(result);
				if (result === true) {
					targetDiv.parent().remove();
					$(".uploadResult").css("background", "darkgray");
				}
			});
		});
	</script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
      $("li.select_time").on("click", function() {
        $(".uploadimage").css("display", "block");
        $(".timetable").css("display", "none");
      });
      
      $(".btn_green1").on("click", function() {
    	  $(".uploadResult").css("background", "none");
    	  $(".reservi").css("background", "#45675b")
    	  $(".reservi").removeAttr("disabled");
    	});
      
      document.querySelector('.reservi').addEventListener('click', function() {
    	  document.querySelector('form').submit();
    	});
    </script>
    <style>
      span.reservi {
        float: right;
        color: white;
        background: gainsboro;
        width: 300px;
        text-align: center;
        height: 70px;
        line-height: 70px;
        font-size: larger;
    }
      ul#floatPC_layer {
        text-align: center;
        padding: 10px;
        color: #767676;
    }
      .float_inner {
        margin: 0 90px;
        box-shadow: 10px 10px 50px rgba(0,0,0,.2);
        width: 300px;
        color: #767676;
        height: 460px;
    }
    ul.list_info {
      padding: 0 20px;
      box-sizing: border-box;
  }
    .exhib_tit {
      position: relative;
      border-bottom: 1px dashed #000;
      box-sizing: border-box;
  }
  .mainbody {
    font-size: 12px;
    max-width: 1000px;
    min-width: 1000px;
}
  li#floatPC_daytime {
    padding: 15px 0;
    font-size: 13px;
    color: #000;
    line-height: 1.3em;
    list-style: none;
}
li#floatPC_time {
  list-style: none;
  padding: 15px 0;
  border-top: 1px solid #e5e5e5;
  font-size: 13px;
  color: #000;
  line-height: 1.3em;
}
      .total {
        display: flex;
    }
      .makeup-main img {
        text-align: center;
        filter: brightness(0.5);
        opacity: 0.9;
        position: relative;
        height: 250px;
        width: 300px;
        object-fit: cover;
    }
      table {
        border-collapse: collapse;
        width: 80%;
        margin: auto;
      }

      td,
      th {
        border: 4px solid white;
        padding: 10px;
        text-align: center;
      }

      td:hover {
        background-color: lightblue;
      }

      .current-day {
        background-color: beige;
      }

      .two-weeks {
        background-color: orange;
      }
      .accordion_cont {
        padding: 50px 45px;
        background: #f3f3f3;
        box-sizing: border-box;
        margin: 0;
      }
      .accordion_cont1 {
        padding: 50px 45px;
        background: #f3f3f3;
        box-sizing: border-box;
        margin: 0;
        display: flex;
        flex-direction: column-reverse;
        align-items: center;
      }
      div#time_body2 {
        line-height: 100%;
      }
      ul.clickTime_left {
        position: relative;
        overflow: hidden;
        margin-bottom: 10px;
        float: left;
        padding-right: 5%;
        display: inline-block;
        border-right: 1px solid #e5e5e5;
        padding-left: 0;
      }
      ul.clickTime_right {
        float: right;
        margin-left: -1px;
        padding-left: 5%;
        display: inline-block;
        border-left: 1px solid #e5e5e5;
      }
      li.select_time {
        float: left;
        margin: 10px 10px 0 0;
        width: calc(100%);
        background: #fff;
        color: #c5c5c5;
        line-height: 52px;
        border-radius: 3px;
        box-sizing: border-box;
        list-style: none;
      }
      a {
        overflow: hidden;
        display: block;
        padding: 0 30px;
      }
      span.time {
        font-size: 14px;
        font-weight: 500;
        color: black;
      }
      .time_wrap.clickTime {
        display: grid;
        align-items: flex-start;
        grid-template-columns: repeat(2, 1fr);
      }

      .time_wrap li.sold_out a span {
        display: block;
        color: #c5c5c5;
        font-weight: 500;
        cursor: not-allowed;
      }
      .g_box dt {
        position: relative;
        margin-bottom: 10px;
        padding-left: 9px;
        font-size: 14px;
        color: #000;
        font-weight: 500;
      }
      .makeupbtn1 {
        text-align: center;
        margin: 20px 0;
      }
      .btn_green {
    float: right;
    color: white;
    background: #45675b;
    width: 150px;
}
.btn_green1 {
    float: right;
    color: white;
    background: #45675b;
    width: 150px;
}
      .btn_gray {
    color: white;
    background: slategray;
    width: 150px;
    text-align: center;
    margin: 20px;
    height: 40px;
    line-height: 40px;
}
      dl {
        padding: 20px;
        border: 1px dashed #e5e5e5;
        background: #fff;
        box-sizing: border-box;
        margin-bottom: 85px;
      }
      dd {
        margin: 10px;
      }
      .uploadbox {
        grid-template-columns: repeat(2, 1fr);
        display: grid;
        place-items: center;
      }
      h3.g-title-1 {
        background-color: #8a9591ba;
        margin: 0;
        padding: 14px 20px;
        color: white;
        font-size: initial;
      }
      .calendargrid {
        grid-template-columns: repeat(2, 1fr);
        display: grid;
        place-items: center;
      }
      #progress {
        appearance: none;
        margin: 10px 90px;
        width: -webkit-fill-available;
      }
      #progress::-webkit-progress-bar {
        background: #f0f0f0;
        border-radius: 10px;
        box-shadow: inset 3px 3px 10px #ccc;
      }
      #progress::-webkit-progress-value {
        border-radius: 10px;
        background: #1d976c;
        background: -webkit-linear-gradient(to right, #93f9b9, #1d976c);
        background: linear-gradient(to right, #93f9b9, #1d976c);
      }
    </style>
  </body>
</html>
